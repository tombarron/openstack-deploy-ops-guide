<?xml version="1.0" encoding="UTF-8"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xi="http://www.w3.org/2001/XInclude" version="5.0" xml:id="section_cinder-deployment-choices">
    <title>Theory of Operation &amp; Deployment Choices</title>
    <simplesect>
        <title>Construct Mappings between Cinder and Data ONTAP</title>
        <formalpara>
            <title>Cinder backends and Storage Virtual Machines</title>
            <para>
                The recommended mapping between a Cinder backend and an SVM is 1:1
            </para>
        </formalpara>
        <formalpara>
            <title>Cinder volumes and FlexVol volumes</title>
            <para>
                Data ONTAP FlexVol volumes (commonly referred to as volumes) and OpenStack Block Storage volumes (commonly referred to as Cinder volumes) are not semantically analogous. A FlexVol volume is a container of logical data elements (for example, for example, files, Snapshot copies, clones, LUNs, et cetera) that is abstracted from physical elements (for example, for example, individual disks, and RAID groups). A Cinder volume is a block device. Most commonly, these block devices are made available to OpenStack Compute instances. NetApp’s various driver options for deployment of FAS as a provider of Cinder storage place Cinder volumes, snapshots copies, and clones within FlexVol volumes. 
            </para>
            <important>
                <para>
                    The FlexVol volume is an overarching container for one or more Cinder volumes.
                </para>
            </important>
        </formalpara>
        <formalpara>
            <title>Cinder volume representation within a FlexVol volume</title>
            <para>
                A Cinder volume has a different representation in Data ONTAP when stored in a FlexVol volume. The difference is dependent on storage protocol utilized with Cinder:
            </para>
            <itemizedlist>
                <listitem><emphasis>iSCSI</emphasis>: When utilizing the iSCSI storage protocol, a Cinder volume is stored as an iSCSI LUN.</listitem>
                <listitem><emphasis>NFS</emphasis>: When utilizing the NFS storage protocol, a Cinder volume is a file on an NFS export.</listitem>
            </itemizedlist>
        </formalpara>
        <formalpara>
            <title>Cinder snapshots versus NetApp snapshots</title>
            <para>
                Compare/contrast Cinder snapshots vs NetApp snapshot (frequency, number, etc)
            </para>
        </formalpara>
    </simplesect>
    <simplesect>
        <title>Deployment Choice: Direct versus Intermediated</title>
        <para>
            Direct vs middleware (DFM, WFA, etc)
        </para>
    </simplesect>
    <simplesect>
        <title>Deployment Choice: FAS vs E-Series</title>
        <para>
            Explain product positioning
        </para>
    </simplesect>
    <simplesect>
        <title>Deployment Choice: Clustered Data ONTAP vs Data ONTAP operating in 7-Mode</title>
        <para>
            Clustered Data ONTAP represents NetApp’s platform for delivering future innovation in the FAS product line. Its inherent qualities of virtualization of network interfaces, disk subsystem, and administrative storage controller map well to OpenStack constructs. The Storage Virtual Machine storage server (SVM, historically referred to as Vserver) can span across all nodes of a given clustered Data ONTAP deployment, for example. The elasticity provided to expand or contract a Storage Virtual Machine across horizontally scalable resources are capabilities critical to cloud deployment unique to the clustered Data ONTAP mode of operation.
        </para>
        <para>
            The Data ONTAP 7-Mode drivers are primarily provided to allow rapid use of prior deployed FAS systems for OpenStack block storage requirements. There is no current intention to enhance the 7-Mode driver’s capabilities beyond providing basic bug fixes.
        </para>
        <important>
            <title>Recommendation</title>
            <para>
                NetApp strongly recommends that all OpenStack deployments built upon NetApp's FAS product set leverage clustered Data ONTAP.
            </para>
        </important>
    </simplesect>
    <simplesect>
        <title>Deployment Choice: NFS versus iSCSI</title>
        <para>
            A frequent question from customers and partners is whether to utilize NFS or iSCSI as the storage protocol with a Cinder deployment ontop of NetApp's FAS product line. 
            Both protocol options are TCP/IP-based, deliver similar throughputs and latencies, support Cinder features, snapshot copies and cloning are supported to similar degrees, as well as advertisement of other storage efficienty, data protection, and high availability features.
        </para>
        <formalpara>
            <title>iSCSI</title>
            <itemizedlist>
                <listitem>At the time of publishing, the maximum number of iSCSI LUNs per NetApp cluster is either 8,192 or 49,152 - dependent on the FAS model number (refer to <link xlink:href="http://hwu.netapp.com">Hardware Universe</link> for detailed information for a particular model). Cinder can be configured to operate with multiple NetApp clusters via multi-backend support to increase this number for an OpenStack deployment.</listitem>
                <listitem>LUNs consume more management resources and some management tools also have limitations on the number of LUNs.</listitem>
                <listitem>When Cinder is used independently of OpenStack Compute, use of iSCSI is essential to provide direct access to block devices. The Cinder driver use in conjunction with NFS relies on libvirt and the hypervisor to represent files on NFS as virtual block devices. When Cinder is utilized in bare-metal or non-virtualized environments, the NFS storage protocol is not an option.</listitem>
            </itemizedlist>
        </formalpara>
        <formalpara>
            <title>NFS</title>
            <itemizedlist>
                <listitem>The maximum number of files in a single FlexVol volume exported through NFS is dependent on the size of the FlexVol volume; a 1TB FlexVol can have 33,554,432 files (assuming 32k inodes). The theoretical maximum of files is roughly two billion.</listitem>
                <listitem>NFS drivers require support from the hypervisor to virtualize files and present them as block devices to an instance.</listitem>
            </itemizedlist>
        </formalpara>
        <itemizedlist>
            <listitem>There is no difference in the maximum size of a Cinder volume regardless of the storage protocol chosen (a file on NFS or an iSCSI LUN are both 16TB). </listitem>
            <listitem>Performance differences between iSCSI and NFS are normally negligible in virtualized environments; for a detailed investigation, please refer to <link xlink:href="http://www.netapp.com/us/system/pdf-reader.aspx?m=tr-3808.pdf&amp;cc=us">NetApp TR3808: VMware vSphere and ESX 3.5 Multiprotocol Performance Comparison using FC, iSCSI, and NFS</link>.</listitem>
        </itemizedlist>
        <important>
            <title>Recommendation</title>
            <para>
                Deploying NetApp's Cinder driver with clustered Data ONTAP utilizing the NFS storage protocol yields a more scalable OpenStack deployment than iSCSI with negligible performance differences. If Cinder is being used to provide block storage services independent of other OpenStack services, the iSCSI protocol must be utilized.
            </para>
        </important>
        <tip>
            <para>
                A related use case for using iSCSI with OpenStack deployments involves creating a FlexVol volume to serve as the storage for OpenStack compute nodes. As more hypervisor nodes are added, a master boot LUN can simply be cloned for each node. Since the configuration of hypervisor nodes are usually nearly identical (except for node-specific data like configuration files, logs, etc), the boot disk lends well to optimizations like deduplication and compression.
            </para>
            <para>
                Currently this configuration must be done outside of the management scope of Cinder, but it serves as another example of how NetApp's differentiated capabilities can be leveraged to ease the deployment and ongoing operation of an OpenStack cloud deployment.
            </para>
        </tip>
    </simplesect>
</section>
