<?xml version="1.0" encoding="UTF-8"?>
<section xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:id="section_cinder-configuration">
    <title>Configuration</title>
    <section xml:id="cinder.configuration">
        <title>Cinder</title>
        <para>
            Cinder is configured by changing the contents of the <filename>cinder.conf</filename> file and restarting all of the Cinder processes. Depending on the OpenStack distribution used, this may require issuing commands such as <command>service openstack-cinder-api restart</command> or <command>service cinder-api restart</command>.
        </para>
        <simplesect>
            <title><filename>cinder.conf</filename></title>
            <para>
                The <filename>cinder.conf</filename> file contains a set of configuration options (one per line), specified as <option>option_name</option>=<replaceable>value</replaceable>. Configuration options are grouped together into a stanza, denoted by <option>[<replaceable>stanza_name</replaceable>]</option>. There must be at least one stanza named <option>[DEFAULT]</option> that contains configuration parameters that apply generically to Cinder (and not to any particular backend). Configuration options that are associated with a particular Cinder backend should be placed in a separate stanza. 
            </para>
            <note>
                <para>
                    While it is possible to specify driver-specific configuration options within the <option>[DEFAULT]</option> stanza, you will be unable to define multiple Cinder backends within the <filename>cinder.conf</filename> file. It is strongly recommended that you specify driver-specific configuration in separate named stanzas, being sure to list the backends that should be enabled as the value for the configuration option <option>enabled_backends</option>; for example: <programlisting>
enabled_backends=myNfsBackend,myIscsiBackend,myESeriesBackend
                </programlisting> The <option>enabled_backends</option> option should be specified within the <option>[DEFAULT]</option> configuration stanza.
                </para>
            </note>
        </simplesect>
    </section>
    <section xml:id="cinder.netapp.drivers">
        <title>NetApp Data ONTAP Drivers for OpenStack Block Storage (Cinder)</title>
        <para>
            NetApp drivers for clustered Data ONTAP and Data ONTAP operating in 7-Mode are now offered in a single, unified driver (in the Grizzly and prior releases, the drivers were written in two separate variants, namely, iSCSI and NFS drivers). The unified driver provides OpenStack with access to NetApp clustered Data ONTAP and Data ONTAP operating in 7-Mode controllers for provisioning and maintaining OpenStack block storage volumes.
        </para>
        <simplesect>
            <title>Where to Obtain the Drivers</title>
            <para>
                NetAppâ€™s contribution strategy involves adding all new capabilities directly into the upstream OpenStack Block Storage repositories, so all the features are available regardless of which distribution you choose when deploying OpenStack. Bug fixes are delivered into the appropriate branches that represent the different releases of OpenStack (e.g. <option>trunk</option>, <option>stable/icehouse</option>, <option>stable/havana</option>, etc). 
            </para>
            <para>
                On occasion, it may be necessary for NetApp to deliver capability to a previous release of OpenStack that can not be accepted in the upstream OpenStack repositories. In that case, we will post the capability at the NetApp Github repository, accessible at <link xlink:href="https://github.com/NetApp/cinder">https://github.com/NetApp/cinder</link>. Be sure to choose the branch from this repository that matches the release version of OpenStack you are deploying with.
            </para>
        </simplesect>
        <simplesect>
            <title>Multiple Deployment Options</title>
            <para>
                A variety of OpenStack block storage deployment options for NetApp Data ONTAP based systems are available in the Icehouse OpenStack release and involve making deployment choices between the following:
            </para>
            <itemizedlist>
                <listitem>Clustered Data ONTAP or Data ONTAP operating in 7-Mode</listitem>
                <listitem>iSCSI or NFS storage protocol</listitem>
            </itemizedlist>
            <para>
                While there are multiple supported deployment options, since the Havana release there is a new, single NetApp unified driver that can be configured to achieve any of the desired deployments. In Grizzly and prior releases, there were multiple drivers segmented by storage family, protocol, and integration with additional NetApp management software. The previous drivers have all been deprecated since the Havana release; see <xref linkend="appendix.packaging.deprecation"/> for more information on the deprecated capabilities. 
            </para>
            <para>
                The following lists all of the individual options and subsequent sections are intended to offer guidance on which configuration options ought to be employed given varying use cases:
            </para>
            <itemizedlist>
                <listitem><xref linkend="cinder.cdot.iscsi.configuration">NetApp clustered Data ONTAP with iSCSI</xref></listitem>
                <listitem><xref linkend="cinder.cdot.nfs.configuration">NetApp clustered Data ONTAP with NFS</xref></listitem>
                <listitem><xref linkend="cinder.7mode.iscsi.configuration">NetApp Data ONTAP operating in 7-Mode with iSCSI</xref></listitem> 
                <listitem><xref linkend="cinder.7mode.nfs.configuration">NetApp Data ONTAP operating in 7-Mode with NFS</xref></listitem>
            </itemizedlist>
        </simplesect>
    </section>
    <section xml:id="cinder.cdot.iscsi.configuration">
        <title>NetApp Unified Driver for Clustered Data ONTAP with iSCSI</title>
        <para>
            The NetApp unified driver for clustered Data ONTAP with iSCSI is a driver interface from OpenStack Cinder to NetApp clustered Data ONTAP storage controllers to accomplish provisioning and management of a storage-area network (SAN) block storage entity; that is, a NetApp LUN using the iSCSI protocol.
        </para>
        <simplesect>
            <title>Configuration Options</title>
            <para>
                To set up the NetApp clustered Data ONTAP iSCSI driver for Cinder, the following stanza should be added to the Cinder configuration file (<filename>cinder.conf</filename>):<programlisting>
[myIscsiBackend] <co id="cdot-iscsi-name-co" linkends="cdot-iscsi-name"/>
volume_backend_name=myIscsiBackend
volume_driver=cinder.volume.drivers.netapp.common.NetAppDriver
netapp_server_hostname=<replaceable>hostname</replaceable>
netapp_server_port=<replaceable>80</replaceable>
netapp_storage_protocol=iscsi <co id="cdot-iscsi-protocol-co" linkends="cdot-iscsi-protocol"/>
netapp_storage_family=ontap_cluster
netapp_login=<replaceable>admin_username</replaceable>
netapp_password=<replaceable>admin_password</replaceable>
netapp_vserver=<replaceable>svm_name</replaceable>
            </programlisting>
            <calloutlist>
                <callout arearefs="cdot-iscsi-name-co" id="cdot-iscsi-name" >
                    <para>Be sure that the value of the <option>enabled_backends</option> option in the <option>[DEFAULT]</option> stanza includes the name of the stanza you chose for the backend.</para>
                </callout>
                <callout arearefs="cdot-iscsi-protocol-co" id="cdot-iscsi-protocol">
                    <para>The value of <option>netapp_storage_protocol</option> MUST be set to <option>iscsi</option>, as the default value for this option is <option>nfs</option>.</para>
                </callout>
            </calloutlist>
            </para>
            <para>
                <xref linkend="cinder.cdot.iscsi.options"/> lists the configuration options available for the unified driver for a clustered Data ONTAP deployment using the iSCSI storage protocol.
            </para>
            <!-- TODO: refer to autogenerated tables in upstream config reference? -->
            <table rules="all" width="100%" xml:id="cinder.cdot.iscsi.options">
                <caption>Configuration options for clustered Data ONTAP with iSCSI</caption>
                <col width="1.65in"/>
                <col width="0.6in"/>
                <col width="0.95in"/>
                <col width="2.55in"/>
                <thead>
                    <tr>
                        <td>Option</td>
                        <td>Type</td>
                        <td>Default Value</td>
                        <td>Description</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><option>netapp_server_hostname</option></td>
                        <td>Required</td>
                        <td></td>
                        <td>The hostname or IP address for the storage system or proxy server. <emphasis>The value of this option should be the IP address of either the cluster management LIF or the SVM management LIF.</emphasis></td>
                    </tr>
                    <tr>
                        <td><option>netapp_server_port</option></td>
                        <td>Optional</td>
                        <td>80</td>
                        <td>The TCP port to use for communication with the storage system or proxy server. Traditionally, port 80 is used for HTTP and port 443 is used for HTTPS; however, this value should be changed if an alternate port has been configured on the storage system or proxy server.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_login</option></td>
                        <td>Required</td>
                        <td></td>
                        <td>Administrative user account name used to access the storage system or proxy server.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_password</option></td>
                        <td>Required</td>
                        <td></td>
                        <td>Password for the administrative user account specified in the <option>netapp_login</option> option.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_storage_protocol</option></td>
                        <td>Required</td>
                        <td><option>nfs</option></td>
                        <td>The storage protocol to be used. Valid options are <option>nfs</option> or <option>iscsi</option>. If None is specified or the option is omitted, <option>nfs</option> will be used.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_transport_type</option></td>
                        <td>Optional</td>
                        <td><option>http</option></td>
                        <td>Transport protocol for communicating with the storage system or proxy server. Valid options include <option>http</option> and <option>https</option>.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_size_multiplier</option></td>
                        <td>Optional</td>
                        <td>1.2</td>
                        <td>When creating volumes, the quantity to be multiplied to the requested OpenStack volume size to ensure enough space is available on the SVM (aka Vserver). <emphasis>This value is currently only used when ISCSI has been selected as the storage protocol to be used.</emphasis></td>
                    </tr>
                    <tr>
                        <td><option>netapp_vserver</option></td>
                        <td>Optional</td>
                        <td></td>
                        <td>This option specifies the storage virtual machine (previously called a Vserver) name on the storage cluster on which provisioning of block storage volumes should occur. If using the NFS storage protocol, this parameter is mandatory for storage service catalog support (utilized by Cinder volume type extra specs support). If this option is specified, the exports belonging to the SVM will only be used for provisioning in the future. Block storage volumes on exports not belonging to the SVM specified by this option will continue to function normally.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_storage_family</option></td>
                        <td>Optional</td>
                        <td><option>ontap_cluster</option></td>
                        <td>The storage family type used on the storage system; valid values are <option>ontap_7mode</option> for using Data ONTAP operating in 7-Mode, <option>ontap_cluster</option> for using clustered Data ONTAP, or <option>eseries</option> for using E-Series.</td>
                    </tr>
                </tbody>
            </table>
            <caution>
                <para>
                    If you specify an account in the <option>netapp_login</option> option that only has SVM administration privileges (rather than cluster administration privileges), some advanced features of the NetApp unified driver will not work and you may see warnings in the Cinder logs. See <xref linkend="cinder.cdot.account_permissions"/> for more details on the required access level permissions for an SVM admin account.
                </para>
            </caution>
        </simplesect>
    </section>
    <section xml:id="cinder.cdot.nfs.configuration">
        <title>NetApp Unified Driver for Clustered Data ONTAP with NFS</title>
        <para>
            The NetApp unifed driver for clustered Data ONTAP with NFS is a driver interface from OpenStack block storage to a Data ONTAP cluster system to accomplish provisioning and management of OpenStack volumes on NFS exports provided by the Data ONTAP cluster system. The NetApp unified driver for the Data ONTAP cluster does not require any additional management software to achieve the desired functionality. It uses NetApp APIs to interact with the Data ONTAP cluster.
        </para>
        <simplesect>
            <title>Configuration Options</title>
            <para>
                To set up the NetApp clustered Data ONTAP NFS driver for Cinder, the following stanza should be added to the Cinder configuration file (<filename>cinder.conf</filename>):<programlisting>
[myNfsBackend] <co id="cdot-nfs-name-co" linkends="cdot-nfs-name"/>
volume_backend_name=myNfsBackend
volume_driver=cinder.volume.drivers.netapp.common.NetAppDriver
netapp_server_hostname=<replaceable>hostname</replaceable>
netapp_server_port=<replaceable>80</replaceable>
netapp_storage_protocol=nfs 
netapp_storage_family=ontap_cluster
netapp_login=<replaceable>admin_username</replaceable>
netapp_password=<replaceable>admin_password</replaceable>
netapp_vserver=<replaceable>svm_name</replaceable>
nfs_shares_config=<replaceable>path_to_nfs_exports_file</replaceable>
            </programlisting>
            <calloutlist>
                <callout arearefs="cdot-nfs-name-co" id="cdot-nfs-name" >
                    <para>Be sure that the value of the <option>enabled_backends</option> option in the <option>[DEFAULT]</option> stanza includes the name of the stanza you chose for the backend.</para>
                </callout>
            </calloutlist>
            </para>
            <note>
                <para>
                    The file referenced in the <option>nfs_shares_config</option> configuration option should contain the NFS exports in the <option>ip:/share</option> format, for example:<programlisting>
10.63.165.215:/nfs/test
10.63.165.215:/nfs2/test2
                </programlisting> where <option>ip</option> corresponds to the IP address assigned to a Data LIF, and <option>share</option> refers to a junction path for a FlexVol volume within an SVM. Make sure that volumes corresponding to exports have read/write permissions set on the Data ONTAP controllers.
                </para>
            </note>
            <para>
                <xref linkend="cinder.cdot.nfs.options"/> lists the configuration options available for the unified driver for a clustered Data ONTAP deployment using the NFS storage protocol.
            </para>
            <!-- TODO: refer to autogenerated tables in upstream config reference? -->
            <table rules="all" width="100%" xml:id="cinder.cdot.nfs.options">
                <caption>Configuration options for clustered Data ONTAP with NFS</caption>
                <col width="1.95in"/>
                <col width="0.6in"/>
                <col width="0.95in"/>
                <col width="2.25in"/>
                <thead>
                    <tr>
                        <td>Option</td>
                        <td>Type</td>
                        <td>Default Value</td>
                        <td>Description</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><option>netapp_server_hostname</option></td>
                        <td>Required</td>
                        <td></td>
                        <td>The hostname or IP address for the storage system or proxy server. <emphasis>The value of this option should be the IP address of either the cluster management LIF or the SVM management LIF.</emphasis></td>
                    </tr>
                    <tr>
                        <td><option>netapp_server_port</option></td>
                        <td>Optional</td>
                        <td>80</td>
                        <td>The TCP port to use for communication with the storage system or proxy server. Traditionally, port 80 is used for HTTP and port 443 is used for HTTPS; however, this value should be changed if an alternate port has been configured on the storage system or proxy server.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_login</option></td>
                        <td>Required</td>
                        <td></td>
                        <td>Administrative user account name used to access the storage system or proxy server.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_password</option></td>
                        <td>Required</td>
                        <td></td>
                        <td>Password for the administrative user account specified in the <option>netapp_login</option> option.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_storage_protocol</option></td>
                        <td>Required</td>
                        <td><option>nfs</option></td>
                        <td>The storage protocol to be used. Valid options are <option>nfs</option> or <option>iscsi</option>. If None is specified or the option is omitted, <option>nfs</option> will be used.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_transport_type</option></td>
                        <td>Optional</td>
                        <td><option>http</option></td>
                        <td>Transport protocol for communicating with the storage system or proxy server. Valid options include <option>http</option> and <option>https</option>.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_copyoffload_tool_path</option></td>
                        <td>Optional</td>
                        <td/>
                        <td>This option specifies the path of the NetApp copy offload tool binary. Ensure that the binary has execute permissions set which allow the effective user of the <command>cinder-volume</command> process to execute the file.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_vserver</option></td>
                        <td>Optional</td>
                        <td></td>
                        <td>This option specifies the storage virtual machine (previously called a Vserver) name on the storage cluster on which provisioning of block storage volumes should occur. If using the NFS storage protocol, this parameter is mandatory for storage service catalog support (utilized by Cinder volume type extra specs support). If this option is specified, the exports belonging to the SVM will only be used for provisioning in the future. Block storage volumes on exports not belonging to the SVM specified by this option will continue to function normally.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_storage_family</option></td>
                        <td>Optional</td>
                        <td><option>ontap_cluster</option></td>
                        <td>The storage family type used on the storage system; valid values are <option>ontap_7mode</option> for using Data ONTAP operating in 7-Mode, <option>ontap_cluster</option> for using clustered Data ONTAP, or <option>eseries</option> for using E-Series.</td>
                    </tr>
                    <tr>
                        <td><option>thres_avl_size_perc_start</option></td>
                        <td>Optional</td>
                        <td>20</td>
                        <td>If the percentage of available space for an NFS share has dropped below the value specified by this option, the NFS image cache will be cleaned.</td>
                    </tr>
                    <tr>
                        <td><option>thres_avl_size_perc_stop</option></td>
                        <td>Optional</td>
                        <td>60</td>
                        <td>When the percentage of available space on an NFS share has reached the percentage specified by this option, the driver will stop clearing files from the NFS image cache that have not been accessed in the last <replaceable>M</replaceable> minutes, where <replaceable>M</replaceable> is the value of the <option>expiry_thres_minutes</option> configuration option.</td>
                    </tr>
                    <tr>
                        <td><option>expiry_thres_minutes</option></td>
                        <td>Optional</td>
                        <td>720</td>
                        <td>This option specifies the threshold for last access time for images in the NFS image cache. When a cache cleaning cycle begins, images in the cache that have not been accessed in the last <replaceable>M</replaceable> minutes, where <replaceable>M</replaceable> is the value of this parameter, will be deleted from the cache to create free space on the NFS share.</td>
                    </tr>
                </tbody>
            </table>
            <caution>
                <para>
                    If you specify an account in the <option>netapp_login</option> option that only has SVM administration privileges (rather than cluster administration privileges), some advanced features of the NetApp unified driver will not work and you may see warnings in the Cinder logs. See <xref linkend="cinder.cdot.account_permissions"/> for more details on the required access level permissions for an SVM admin account.
                </para>
            </caution>
        </simplesect>
    </section>
    <section xml:id="cinder.7mode.iscsi.configuration">
        <title>NetApp Unified Driver for Data ONTAP operating in 7-Mode with iSCSI</title>
        <para>
            The NetApp unified driver for Data ONTAP operating in 7-Mode with iSCSI is a driver interface from OpenStack Cinder to NetApp Data ONTAP operating in 7-Mode storage controllers to accomplish provisioning and management of a storage-area network (SAN) block storage entity; that is, a NetApp LUN using the iSCSI protocol.
        </para>
        <simplesect>
            <title>Configuration Options</title>
            <para>
                To set up the NetApp Data ONTAP operating in 7-Mode iSCSI driver for Cinder, the following stanza should be added to the Cinder configuration file (<filename>cinder.conf</filename>):<programlisting>
[myIscsiBackend] <co id="7mode-iscsi-name-co" linkends="7mode-iscsi-name"/>
volume_backend_name=myIscsiBackend
volume_driver=cinder.volume.drivers.netapp.common.NetAppDriver
netapp_server_hostname=<replaceable>hostname</replaceable>
netapp_server_port=<replaceable>80</replaceable>
netapp_storage_protocol=iscsi <co id="7mode-iscsi-protocol-co" linkends="7mode-iscsi-protocol"/> 
netapp_storage_family=ontap_7mode <co id="7mode-iscsi-family-co" linkends="7mode-iscsi-family"/>
netapp_login=<replaceable>admin_username</replaceable>
netapp_password=<replaceable>admin_password</replaceable>
            </programlisting>
            <calloutlist>
                <callout arearefs="7mode-iscsi-name-co" id="7mode-iscsi-name" >
                    <para>Be sure that the value of the <option>enabled_backends</option> option in the <option>[DEFAULT]</option> stanza includes the name of the stanza you chose for the backend.</para>
                </callout>
                <callout arearefs="7mode-iscsi-protocol-co" id="7mode-iscsi-protocol">
                    <para>The value of <option>netapp_storage_protocol</option> MUST be set to <option>iscsi</option>, as the default value for this option is <option>nfs</option>.</para>
                </callout>
                <callout arearefs="7mode-iscsi-family-co" id="7mode-iscsi-family" >
                    <para>The value of <option>netapp_storage_family</option> MUST be set to <option>ontap_7mode</option>, as the default value for this option is <option>ontap_cluster</option>.</para>
                </callout>
            </calloutlist>
            </para>
            <para>
                <xref linkend="cinder.7mode.iscsi.options"/> lists the configuration options available for the unified driver for a clustered Data ONTAP deployment using the iSCSI storage protocol.
            </para>
            <!-- TODO: refer to autogenerated tables in upstream config reference? -->
            <table rules="all" width="100%" xml:id="cinder.7mode.iscsi.options">
                <caption>Configuration options for Data ONTAP operating in 7-Mode with iSCSI</caption>
                <col width="1.65in"/>
                <col width="0.6in"/>
                <col width="0.95in"/>
                <col width="2.55in"/>
                <thead>
                    <tr>
                        <td>Option</td>
                        <td>Type</td>
                        <td>Default Value</td>
                        <td>Description</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><option>netapp_server_hostname</option></td>
                        <td>Required</td>
                        <td></td>
                        <td>The hostname or IP address for the storage system or proxy server. <emphasis>The value of this option should be the IP address of either the cluster management LIF or the SVM management LIF.</emphasis></td>
                    </tr>
                    <tr>
                        <td><option>netapp_server_port</option></td>
                        <td>Optional</td>
                        <td>80</td>
                        <td>The TCP port to use for communication with the storage system or proxy server. Traditionally, port 80 is used for HTTP and port 443 is used for HTTPS; however, this value should be changed if an alternate port has been configured on the storage system or proxy server.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_login</option></td>
                        <td>Required</td>
                        <td></td>
                        <td>Administrative user account name used to access the storage system or proxy server.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_password</option></td>
                        <td>Required</td>
                        <td></td>
                        <td>Password for the administrative user account specified in the <option>netapp_login</option> option.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_storage_protocol</option></td>
                        <td>Required</td>
                        <td><option>nfs</option></td>
                        <td>The storage protocol to be used. Valid options are <option>nfs</option> or <option>iscsi</option>. If None is specified or the option is omitted, <option>nfs</option> will be used.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_transport_type</option></td>
                        <td>Optional</td>
                        <td><option>http</option></td>
                        <td>Transport protocol for communicating with the storage system or proxy server. Valid options include <option>http</option> and <option>https</option>.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_size_multiplier</option></td>
                        <td>Optional</td>
                        <td>1.2</td>
                        <td>When creating volumes, the quantity to be multiplied to the requested OpenStack volume size to ensure enough space is available on the SVM (aka Vserver). <emphasis>This value is currently only used when ISCSI has been selected as the storage protocol to be used.</emphasis></td>
                    </tr>
                    <tr>
                        <td><option>netapp_volume_list</option></td>
                        <td>Optional</td>
                        <td/>
                        <td>This option is only utilized when the storage protocol is configured to use iSCSI. This option is used to restrict provisioning to the specified controller volumes. Specify the value of this option to be a comma separated list of NetApp controller volume names to be used for provisioning.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_vfiler</option></td>
                        <td>Optional</td>
                        <td/>
                        <td>The vFiler unit on which provisioning of block storage volumes will be done. This option is only used by the driver when connecting to an instance with a storage family of Data ONTAP operating in 7-Mode and the storage protocol selected is iSCSI. Only use this option when utilizing the MultiStore feature on the NetApp storage system.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_storage_family</option></td>
                        <td>Optional</td>
                        <td><option>ontap_cluster</option></td>
                        <td>The storage family type used on the storage system; valid values are <option>ontap_7mode</option> for using Data ONTAP operating in 7-Mode, <option>ontap_cluster</option> for using clustered Data ONTAP, or <option>eseries</option> for using E-Series.</td>
                    </tr>
                </tbody>
            </table>
        </simplesect>
    </section>
    <section xml:id="cinder.7mode.nfs.configuration">
        <title>NetApp Unified Driver for Data ONTAP operating in 7-Mode with NFS</title>
        <para>
            The NetApp unifed driver for Data ONTAP operating in 7-Mode with NFS is a driver interface from OpenStack block storage to a Data ONTAP cluster system to accomplish provisioning and management of OpenStack volumes on NFS exports provided by the Data ONTAP cluster system. The NetApp unified driver for the Data ONTAP cluster does not require any additional management software to achieve the desired functionality. It uses NetApp APIs to interact with the Data ONTAP cluster.
        </para>
        <simplesect>
            <title>Configuration Options</title>
            <para>
                To set up the NetApp Data ONTAP operating in 7-Mode NFS driver for Cinder, the following stanza should be added to the Cinder configuration file (<filename>cinder.conf</filename>):<programlisting>
[myNfsBackend] <co id="7mode-nfs-name-co" linkends="7mode-nfs-name"/>
volume_backend_name=myNfsBackend
volume_driver=cinder.volume.drivers.netapp.common.NetAppDriver
netapp_server_hostname=<replaceable>hostname</replaceable>
netapp_server_port=<replaceable>80</replaceable>
netapp_storage_protocol=nfs 
netapp_storage_family=ontap_7mode <co id="7mode-nfs-family-co" linkends="7mode-nfs-family"/>
netapp_login=<replaceable>admin_username</replaceable>
netapp_password=<replaceable>admin_password</replaceable>
nfs_shares_config=<replaceable>path_to_nfs_exports_file</replaceable>
            </programlisting>
            <calloutlist>
                <callout arearefs="7mode-nfs-name-co" id="7mode-nfs-name" >
                    <para>Be sure that the value of the <option>enabled_backends</option> option in the <option>[DEFAULT]</option> stanza includes the name of the stanza you chose for the backend.</para>
                </callout>
                <callout arearefs="7mode-nfs-family-co" id="7mode-nfs-family" >
                    <para>The value of <option>netapp_storage_family</option> MUST be set to <option>ontap_7mode</option>, as the default value for this option is <option>ontap_cluster</option>.</para>
                </callout>
            </calloutlist>
            </para>
            <note>
                <para>
                    The file referenced in the <option>nfs_shares_config</option> configuration option should contain the NFS exports in the <option>ip:/share</option> format, for example:<programlisting>
10.63.165.215:/nfs/test
10.63.165.215:/nfs2/test2
                </programlisting> where <option>ip</option> corresponds to the IP address assigned to a Data LIF, and <option>share</option> refers to a junction path for a FlexVol volume within an SVM. Make sure that volumes corresponding to exports have read/write permissions set on the Data ONTAP controllers.
                </para>
            </note>
            <para>
                <xref linkend="cinder.7mode.nfs.options"/> lists the configuration options available for the unified driver for a Data ONTAP operating in 7-Mode deployment using the NFS storage protocol.
            </para>
            <!-- TODO: refer to autogenerated tables in upstream config reference? -->
            <table rules="all" width="100%" xml:id="cinder.7mode.nfs.options">
                <caption>Configuration options for Data ONTAP operating in 7-Mode with NFS</caption>
                <col width="1.95in"/>
                <col width="0.6in"/>
                <col width="0.95in"/>
                <col width="2.25in"/>
                <thead>
                    <tr>
                        <td>Option</td>
                        <td>Type</td>
                        <td>Default Value</td>
                        <td>Description</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><option>netapp_server_hostname</option></td>
                        <td>Required</td>
                        <td></td>
                        <td>The hostname or IP address for the storage system or proxy server. <emphasis>The value of this option should be the IP address of either the cluster management LIF or the SVM management LIF.</emphasis></td>
                    </tr>
                    <tr>
                        <td><option>netapp_server_port</option></td>
                        <td>Optional</td>
                        <td>80</td>
                        <td>The TCP port to use for communication with the storage system or proxy server. Traditionally, port 80 is used for HTTP and port 443 is used for HTTPS; however, this value should be changed if an alternate port has been configured on the storage system or proxy server.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_login</option></td>
                        <td>Required</td>
                        <td></td>
                        <td>Administrative user account name used to access the storage system or proxy server.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_password</option></td>
                        <td>Required</td>
                        <td></td>
                        <td>Password for the administrative user account specified in the <option>netapp_login</option> option.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_storage_protocol</option></td>
                        <td>Required</td>
                        <td><option>nfs</option></td>
                        <td>The storage protocol to be used. Valid options are <option>nfs</option> or <option>iscsi</option>. If None is specified or the option is omitted, <option>nfs</option> will be used.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_transport_type</option></td>
                        <td>Optional</td>
                        <td><option>http</option></td>
                        <td>Transport protocol for communicating with the storage system or proxy server. Valid options include <option>http</option> and <option>https</option>.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_storage_family</option></td>
                        <td>Optional</td>
                        <td><option>ontap_cluster</option></td>
                        <td>The storage family type used on the storage system; valid values are <option>ontap_7mode</option> for using Data ONTAP operating in 7-Mode, <option>ontap_cluster</option> for using clustered Data ONTAP, or <option>eseries</option> for using E-Series.</td>
                    </tr>
                    <tr>
                        <td><option>thres_avl_size_perc_start</option></td>
                        <td>Optional</td>
                        <td>20</td>
                        <td>If the percentage of available space for an NFS share has dropped below the value specified by this option, the NFS image cache will be cleaned.</td>
                    </tr>
                    <tr>
                        <td><option>thres_avl_size_perc_stop</option></td>
                        <td>Optional</td>
                        <td>60</td>
                        <td>When the percentage of available space on an NFS share has reached the percentage specified by this option, the driver will stop clearing files from the NFS image cache that have not been accessed in the last <replaceable>M</replaceable> minutes, where <replaceable>M</replaceable> is the value of the <option>expiry_thres_minutes</option> configuration option.</td>
                    </tr>
                    <tr>
                        <td><option>expiry_thres_minutes</option></td>
                        <td>Optional</td>
                        <td>720</td>
                        <td>This option specifies the threshold for last access time for images in the NFS image cache. When a cache cleaning cycle begins, images in the cache that have not been accessed in the last <replaceable>M</replaceable> minutes, where <replaceable>M</replaceable> is the value of this parameter, will be deleted from the cache to create free space on the NFS share.</td>
                    </tr>
                </tbody>
            </table>
        </simplesect>
    </section>
    <section xml:id="cinder.fas.configuration">
        <title>Data ONTAP Configuration</title>
        <simplesect>
            <title>Data ONTAP Prerequisites</title>
            <para>
                The prerequisites for Data ONTAP (both clustered Data ONTAP and Data ONTAP operating in 7-Mode) are:
                <itemizedlist>
                    <listitem>The driver requires a storage controller running Data ONTAP 8.1.1 or later.</listitem>
                    <listitem>The storage system should have the following licenses applied:
                        <itemizedlist>
                            <listitem>Base</listitem>
                            <listitem>NFS (if using NFS storage protocol)</listitem>
                            <listitem>iSCSI (if using iSCSI storage protocol)</listitem>
                            <listitem>FlexClone</listitem>
                            <listitem>vStorage (if using NFS storage protocol with Copy Offload tool)</listitem>
                            <listitem>MultiStore (if using vFilers with 7-Mode)</listitem>
                        </itemizedlist>
                    </listitem>
                </itemizedlist>
            </para>
        </simplesect>
        <simplesect>
            <title>Storage Virtual Machine Considerations</title>
            <para>
                <orderedlist>
                    <listitem>Ensure the appropriate licenses (as described previously) are enabled on the storage system for the desired use case.</listitem>
                    <listitem>The SVM must be created (and associated with aggregates) before it can be utilized as a provisioning target for Cinder.</listitem>
                    <listitem>FlexVol volumes must be created before the integration with Cinder is configured, as there is a many-to-one relationship between Cinder volumes and FlexVol volumes (see <xref linkend="section_cinder-deployment-choices"/> for more information).</listitem>
                    <listitem>Regardless of the storage protocol used, data LIFs must be created and assigned to SVMs before configuring Cinder.</listitem>
                    <listitem>If using NFS as the storage protocol:
                        <orderedlist>
                            <listitem>Be sure to enable the desired version of the NFS protocol (e.g. <option>v4.0, v4.1-pnfs</option>) on the SVM.</listitem>
                            <listitem>Be sure to define junction paths from the FlexVol volumes and refer to them in the file referenced by the <option>nfs_shares_config</option> configuration option in <filename>cinder.conf</filename>.</listitem>
                        </orderedlist>
                    </listitem>
                    <listitem>If using iSCSI as the storage protocol:
                        <orderedlist>
                            <listitem>Be sure to create an <option>igroup</option> for Linux that is associated correctly with the SVM.</listitem>
                            <listitem>Please note that iSCSI LUNs will be created by Cinder; therefore, it is not necessary to create LUNs before configuring Cinder.</listitem>
                        </orderedlist>
                    </listitem>
                    <listitem>Once FlexVol volumes have been created, be sure to configure the desired features (e.g. deduplication, compression, SnapMirror relationships, etc) before configuring Cinder. While Cinder will periodically poll Data ONTAP to discover changes in configuration and/or features, there is a delay in time between when changes are performed and when they are reflected within Cinder.</listitem>
                    <listitem>The autogrow capability for FlexVol volumes within Data ONTAP is not recommended for use with a Cinder deployment.</listitem>
                </orderedlist>
            </para>
        </simplesect>
        <simplesect xml:id="cinder.cdot.account_permissions">
            <title>Account Permission Considerations</title>
            <para>
                When configuring the NetApp unified driver to interact with a clustered Data ONTAP instance, you must specify the administrative account to use when operations are invoked by the Cinder driver. While an account with cluster-level administrative permissions is normally utilized, it is possible to use an account with SVM-level scope. In order to use an SVM-scoped account with the Cinder driver and clustered Data ONTAP and have access to the full set of features (including Cinder Volume Type Extra Specs support) availed by the Cinder driver, be sure to add the access levels for the commands shown in <xref linkend="cinder.cdot.permissions"/>.
            </para>
            <table rules="all" width="100%" xml:id="cinder.cdot.permissions">
                <caption>Access Level Permissions Required with SVM Administrative Account</caption>
                <col width="0.95in"/>
                <col width="0.95in"/>
                <col width="2.55in"/>
                <thead>
                    <tr>
                        <td>Command</td>
                        <td>Access Level</td>
                        <td>Description</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><option>event</option></td>
                        <td><option>all</option></td>
                        <td>Permits submission of ASUP events</td>
                    </tr>
                    <tr>
                        <td><option>network interface</option></td>
                        <td><option>readonly</option></td>
                        <td>Read network configuration of SVM</td>
                    </tr>
                    <tr>
                        <td><option>security</option></td>
                        <td><option>readonly</option></td>
                        <td>Read security settings from SVM</td>
                    </tr>
                    <tr>
                        <td><option>snapmirror</option></td>
                        <td><option>readonly</option></td>
                        <td>Determine presence of SnapMirror relationships</td>
                    </tr>
                    <tr>
                        <td><option>storage aggregate</option></td>
                        <td><option>readonly</option></td>
                        <td>Determine disk and RAID types of aggregates</td>
                    </tr>
                    <tr>
                        <td><option>storage disk</option></td>
                        <td><option>readonly</option></td>
                        <td>Determine disk and RAID types of aggregates</td>
                    </tr>
                    <tr>
                        <td><option>version</option></td>
                        <td><option>all</option></td>
                        <td>Determine version of ONTAP</td>
                    </tr>
                    <tr>
                        <td><option>volume</option></td>
                        <td><option>readonly</option></td>
                        <td>Determine volume metadata (space, QoS, etc.)</td>
                    </tr>
                    <tr>
                        <td><option>volume efficiency</option></td>
                        <td><option>readonly</option></td>
                        <td>Determine deduplication and compression configuration</td>
                    </tr>
                    <tr>
                        <td><option>volume file clone create</option></td>
                        <td><option>all</option></td>
                        <td>Create file clones for use with Cinder provisioning and snapshots</td>
                    </tr>
                    <tr>
                        <td><option>volume file modify</option></td>
                        <td><option>all</option></td>
                        <td>Support for Cinder volume extend capability</td>
                    </tr>
                    <tr>
                        <td><option>volume file show-disk-usage</option></td>
                        <td><option>readonly</option></td>
                        <td>Determine available and consumed space</td>
                    </tr>
                    <tr>
                        <td><option>vserver</option></td>
                        <td><option>readonly</option></td>
                        <td>Determine configuration of SVM</td>
                    </tr>
                </tbody>
            </table>
            <tip>
                <para>
                    For more information on how to grant these access level permissions to a role, and then assign the role to an SVM administrative account, please refer to the <link xlink:href="http://support.netapp.com">System Administration Guide for Cluster Administrators</link> document in the Clustered DATA ONTAP documentation.
                </para>
            </tip>
        </simplesect>
        <simplesect>
            <title>Storage Networking Considerations</title>
            <para>
                <orderedlist>
                    <listitem>Ensure there is segmented network connectivity between the hypervisor nodes and the Data LIF interfaces from Data ONTAP.</listitem>
                    <listitem>When NFS is used as the storage protocol with Cinder, the node running the <command>cinder-volume</command> process will attempt to mount the NFS shares listed in the file referred to within the <option>nfs_shares_config</option> configuration option in <filename>cinder.conf</filename>. Ensure that there is appropriate network connectivity between the <command>cinder-volume</command> node and the Data LIF interfaces, as well as the cluster/SVM management interfaces.</listitem>
                </orderedlist>
            </para>
        </simplesect>
    </section>
    <section xml:id="cinder.eseries.iscsi.configuration">
        <title>NetApp E-Series Driver for OpenStack Block Storage (Cinder)</title>
        <para>
            The NetApp E-Series driver for Cinder was introduced in the Icehouse release as a new storage family supported within the NetApp unified driver framework. The E-Series driver provides OpenStack with access to NetApp E-Series controllers for provisioning and maintaining OpenStack block storage volumes using the iSCSI protocol.
        </para>
        <simplesect>
            <title>Deployment Topology</title>
            <para>
                As described in <xref linkend="section_cinder-deployment-choices"/>, using Cinder with NetApp E-Series requires the use of the NetApp SANtricity Web Services Proxy server deployed as an intermediary between Cinder and the E-Series storage system. A common deployment topology with Cinder, Nova, and an E-Series controller with the SANtricity Web Services Proxy can be seen in <xref linkend="cinder.eseries.deployment_topology"/>.
            </para>
            <figure xml:id="cinder.eseries.deployment_topology">
                <title>Cinder &amp; E-Series Deployment Topology</title>
                <mediaobject>
                    <imageobject>
                        <imagedata fileref="../images/cinder_eseries_deployment_topology.png" align="center" width="5.75in"/> 
                    </imageobject>
                    <textobject>
                        <phrase>An logical diagram of the deployment topology with Cinder and NetApp's E-Series Storage Solutions</phrase>
                    </textobject>
                </mediaobject>
            </figure>
            <!-- TODO: talk about HA deployment of proxy server -->
            <tip>
                <para>
                    Documentation (including installation instructions) for the NetApp SANtricity Web Services Proxy server are available for download at <link xlink:href="https://library.netapp.com/ecm/ecm_download_file/ECMP1506075">https://library.netapp.com/ecm/ecm_download_file/ECMP1506075</link>.
                </para>
            </tip>
            <para>
                Dynamic disk pools (as described in <xref linkend="section_e-ef-series"/>) are the only supported disk collection strategy when utilizing the Cinder E-Series driver. For more information on the capabilities of the E-Series storage systems, visit <link xlink:href="http://support.netapp.com">http://support.netapp.com</link>. 
            </para>
            <tip>
                <para>
                    While formally introduced in the Icehouse release of OpenStack, NetApp has backported the E-Series driver to the Grizzly and Havana releases of OpenStack, accessible at <link xlink:href="https://github.com/NetApp/cinder">https://github.com/NetApp/cinder</link>. Be sure to choose the branch from this repository that matches the release version of OpenStack you are deploying with. 
                </para>
            </tip>
        </simplesect>
        <simplesect>
            <title>Configuration Options</title>
            <para>
                To set up the NetApp E-Series driver for Cinder, the following stanza should be added to the Cinder configuration file (<filename>cinder.conf</filename>):<programlisting>
[myESeriesBackend] <co id="eseries-iscsi-name-co" linkends="eseries-iscsi-name"/>
volume_backend_name=myESeriesBackend
volume_driver=cinder.volume.drivers.netapp.common.NetAppDriver
netapp_server_hostname=<replaceable>hostname</replaceable>
netapp_server_port=<replaceable>80</replaceable>
netapp_storage_protocol=iscsi <co id="eseries-iscsi-protocol-co" linkends="eseries-iscsi-protocol"/> 
netapp_storage_family=eseries <co id="eseries-iscsi-family-co" linkends="eseries-iscsi-family"/> 
netapp_controller_ips=<replaceable>1.2.3.4,1.2.3.5</replaceable>
netapp_sa_password=<replaceable>storage_array_password</replaceable>
netapp_storage_pools=<replaceable>myPool1,myPool2</replaceable>
netapp_login=<replaceable>admin_username</replaceable>
netapp_password=<replaceable>admin_password</replaceable>
            </programlisting>
            <calloutlist>
                <callout arearefs="eseries-iscsi-name-co" id="eseries-iscsi-name">
                    <para>Be sure that the value of the <option>enabled_backends</option> option in the <option>[DEFAULT]</option> stanza includes the name of the stanza you chose for the backend.</para>
                </callout>
                <callout arearefs="eseries-iscsi-protocol-co" id="eseries-iscsi-protocol">
                    <para>As the E-Series solution only provides block storage services, the value of <option>netapp_storage_protocol</option> MUST be set to <option>iscsi</option>.</para>
                </callout>
                <callout arearefs="eseries-iscsi-family-co" id="eseries-iscsi-family" >
                    <para>The value of <option>netapp_storage_family</option> MUST be set to <option>eseries</option>, as the default value for this option is <option>ontap_cluster</option>.</para>
                </callout>
            </calloutlist>
            </para>
            <para>
                <xref linkend="cinder.eseries.iscsi.options"/> lists the configuration options available for the unified driver for a E-Series deployment using the iSCSI storage protocol.
            </para>
            <!-- TODO: refer to autogenerated tables in upstream config reference? -->
            <table rules="all" width="100%" xml:id="cinder.eseries.iscsi.options">
                <caption>Configuration options for E-Series with iSCSI</caption>
                <col width="1.65in"/>
                <col width="0.6in"/>
                <col width="0.95in"/>
                <col width="2.55in"/>
                <thead>
                    <tr>
                        <td>Option</td>
                        <td>Type</td>
                        <td>Default Value</td>
                        <td>Description</td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><option>netapp_server_hostname</option></td>
                        <td>Required</td>
                        <td></td>
                        <td>The hostname or IP address for the proxy server.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_server_port</option></td>
                        <td>Optional</td>
                        <td>80</td>
                        <td>The TCP port to use for communication with the proxy server. Traditionally, port 80 is used for HTTP and port 443 is used for HTTPS; however, this value should be changed if an alternate port has been configured on the proxy server.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_login</option></td>
                        <td>Required</td>
                        <td></td>
                        <td>Administrative user account name used to access the proxy server.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_password</option></td>
                        <td>Required</td>
                        <td></td>
                        <td>Password for the administrative user account specified in the <option>netapp_login</option> option.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_storage_protocol</option></td>
                        <td>Required</td>
                        <td><option>nfs</option></td>
                        <td>The storage protocol to be used. Valid options are <option>nfs</option> or <option>iscsi</option>. If None is specified or the option is omitted, <option>nfs</option> will be used.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_transport_type</option></td>
                        <td>Optional</td>
                        <td><option>http</option></td>
                        <td>Transport protocol for communicating with the proxy server. Valid options include <option>http</option> and <option>https</option>.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_webservice_path</option></td>
                        <td>Optional</td>
                        <td><option>/devmgr/v2</option></td>
                        <td>This option is used to specify the path to the E-Series proxy application on a proxy server. The value is combined with the value of the <option>netapp_transport_type</option>, <option>netapp_server_hostname</option>, and <option>netapp_server_port</option> options to create the URL used by the driver to connect to the proxy application.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_controller_ips</option></td>
                        <td>Optional</td>
                        <td/>
                        <td>This option is only utilized when the storage family is configured to <option>eseries</option>. This option is used to restrict provisioning to the specified controllers. Specify the value of this option to be a comma separated list of controller hostnames or IP addresses to be used for provisioning.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_sa_password</option></td>
                        <td>Optional</td>
                        <td/>
                        <td>Password for the NetApp E-Series storage array.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_storage_pools</option></td>
                        <td>Optional</td>
                        <td/>
                        <td>This option is used to restrict provisioning to the specified storage pools. Only dynamic disk pools are currently supported. Specify the value of this option to be a comma separated list of disk pool names to be used for provisioning.</td>
                    </tr>
                    <tr>
                        <td><option>netapp_storage_family</option></td>
                        <td>Optional</td>
                        <td><option>ontap_cluster</option></td>
                        <td>The storage family type used on the storage system; valid values are <option>ontap_7mode</option> for using Data ONTAP operating in 7-Mode, <option>ontap_cluster</option> for using clustered Data ONTAP, or <option>eseries</option> for using E-Series.</td>
                    </tr>
                </tbody>
            </table>
        </simplesect>
    </section>
    <section xml:id="cinder.eseries.configuration">
        <title>E-Series Configuration</title>
        <simplesect>
            <title>E-Series Prerequisites</title>
            <para>
                The prerequisites for NetApp E-Series are:
            </para>
            <itemizedlist>
                <listitem>The driver requires the use of the NetApp SANtricity Web Services Proxy version 1.0 or greater.</listitem>
                <listitem>The storage controller should have a firmware version installed that is supported by the NetApp SANtricity Web Services Proxy. Refer to the proxy documentation for the most recent list of firmware versions that are supported.</listitem>
            </itemizedlist>
        </simplesect>
        <simplesect>
            <title>Storage Networking Considerations</title>
            <para>
                <orderedlist>
                    <listitem>Ensure there is segmented network connectivity between the hypervisor nodes and the network interfaces present on the E-Series controller.</listitem>
                    <listitem>Ensure there is network connectivity between the <command>cinder-volume</command> nodes and the interfaces present on the node running the NetApp SANtricity Web Services Proxy software.</listitem>
                </orderedlist>
            </para>
        </simplesect>
    </section>
</section>
