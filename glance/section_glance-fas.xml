<?xml version="1.0" encoding="UTF-8"?>
<section xmlns="http://docbook.org/ns/docbook"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
    xml:id="section_glance-fas">
    <title>Configuration of Glance with NetApp FAS</title>
    <para>
        Glance can be configured to use one of a variety of storage backends for storing images for use within an OpenStack environment.
    </para>
    <para>
        When using the file storage backend, the <option>filesystem_store_datadir</option> configuration option in <filename>/etc/glance/glance-api.conf</filename> will declare the directory Glance will use to store images (relative to the node running the <command>glance-api</command> service). 
    </para>
    <programlisting lang="ini">
$ #for RHEL/CentOS/Fedora derived distributions
$ sudo openstack-config --get /etc/glance/glance-api.conf \
DEFAULT filesystem_store_datadir 
/var/lib/glance/images/

$ #for Ubuntu derived distributions
$ sudo cat /etc/glance/glance-api.conf|grep \
filesystem_store_datadir|egrep -v "^#.*"
filesystem_store_datadir=/var/lib/glance/images/
    </programlisting>
    <para>
        By specifying the value of <option>filesystem_store_datadir</option> to be a directory that is the mount point for an NFS share that is served from a NetApp FlexVol volume, you can have a single filesystem that can be mounted from one or more <command>glance-api</command> servers. 
    </para>
    <para>
        If a single FlexVol volume will contain Cinder volumes in addition to Glance images, be sure to set the <option>show_image_direct_url</option> configuration option to <literal>True</literal> in <filename>/etc/glance/glance-api.conf</filename>. This ensures that the appropriate metadata will be passed to Cinder so that it can attempt to rapidly clone the image directly on the controller, avoiding the HTTP transfer between Glance and Cinder. See ADD REF HERE for more information on the Enhanced Image Cloning capability.
    </para>
    <simplesect>
        <title>Enabling Deduplication for OpenStack Image Service</title>
        <para>
            Since there is a high probability of duplicate blocks in a repository of virtual machine images, it is highly recommended to enable deduplication on the FlexVol volume(s) where the images are stored. You can check the status of deduplication for a particular FlexVol volume by using the <command>volume efficiency show</command> command as seen below. 
        </para>
        <programlisting lang="ini">
demo-cluster::> volume efficiency show -vserver demo-vserver -volume vol2 

                     Vserver Name: demo-vserver
                     Volume Name: vol2
                     Volume Path: /vol/vol2
                     State: Disabled
                     Status: Idle
                     Progress: Idle for 00:19:53
                     Type: Regular
                     Schedule: sun-sat@0
                     Efficiency Policy Name: -
                     Blocks Skipped Sharing: 0
                     Last Operation State: Success
                     Last Success Operation Begin: 
                        Thu Nov 21 14:19:23 UTC 2013
                     Last Success Operation End: 
                        Thu Nov 21 14:20:40 UTC 2013
                     Last Operation Begin: 
                        Thu Nov 21 14:19:23 UTC 2013
                     Last Operation End: 
                        Thu Nov 21 14:20:40 UTC 2013
                     Last Operation Size: 0B
                     Last Operation Error: -
                     Changelog Usage: 0%
                     Logical Data Size: 224KB
                     Logical Data Limit: 640TB
                     Logical Data Percent: 0%
                     Queued Job: -
                     Stale Fingerprint Percentage: 0
                     Compression: false
                     Inline Compression: false
                     Incompressible Data Detection: false
                     Constituent Volume: false
                     Compression Quick Check File Size: 524288000
demo-cluster::> volume efficiency on -vserver demo-vserver -volume vol2
Efficiency for volume "vol2" of Vserver "demo-vserver" is enabled.
Already existing data could be processed by running "volume efficiency 
start -vserver demo-vserver -volume vol2 -scan-old-data true". 
        </programlisting>
    </simplesect>
</section>
